# SweetsShipStrike ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯è¨­è¨ˆæ›¸

## ğŸ“‹ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæƒ…å ±
- **ä½œæˆæ—¥**: 2025å¹´10æœˆ31æ—¥
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0
- **å¯¾è±¡**: SweetsShipStrike ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯è©³ç´°ä»•æ§˜
- **å‚ç…§**: ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆæ›¸ã¨åˆã‚ã›ã¦ä½¿ç”¨

---

## ğŸ® ã‚²ãƒ¼ãƒ æ¦‚è¦

### åŸºæœ¬ãƒ«ãƒ¼ãƒ«
- 10Ã—10ãƒã‚¹ã®ãƒœãƒ¼ãƒ‰ã§å¯¾æˆ¦
- å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯4éš»ã®ä¹—ã‚Šç‰©ã‚’é…ç½®
- ã‚¿ãƒ¼ãƒ³åˆ¶ã§ç›¸æ‰‹ã®ãƒœãƒ¼ãƒ‰ã‚’æ”»æ’ƒ
- ç›¸æ‰‹ã®ä¹—ã‚Šç‰©ã‚’å…¨ã¦æ’ƒæ²ˆã—ãŸã‚‰å‹åˆ©
- ãƒ’ãƒƒãƒˆæ™‚ã¯é€£ç¶šæ”»æ’ƒå¯èƒ½
- å„ä¹—ã‚Šç‰©ã¯1è©¦åˆã«1å›ã ã‘ä½¿ãˆã‚‹ã‚¹ã‚­ãƒ«ã‚’æŒã¤

### ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚·ã‚¹ãƒ†ãƒ ï¼ˆMVPç‰ˆï¼‰
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯4äººã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‹ã‚‰1äººã‚’é¸æŠ
- **MVPç‰ˆã§ã¯è¦‹ãŸç›®ã®ã¿ã®é•ã„**ï¼ˆèƒ½åŠ›å·®ãªã—ï¼‰
- ç´”ç²‹ã«å¥½ããªã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’é¸ã‚“ã§æ¥½ã—ã‚€
- å°†æ¥çš„ã«ãƒ‘ãƒƒã‚·ãƒ–èƒ½åŠ›ã‚’å®Ÿè£…äºˆå®š

---

## ğŸš¢ ä¹—ã‚Šç‰©ä»•æ§˜

### å›ºå®šç·¨æˆï¼ˆå…¨ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å…±é€šï¼‰

| ä¹—ã‚Šç‰©å | ã‚¿ã‚¤ãƒ— | ã‚µã‚¤ã‚º | ã‚¹ã‚­ãƒ«å | ã‚¹ã‚­ãƒ«åŠ¹æœ |
|---------|--------|--------|----------|-----------|
| ã‚¤ãƒã‚´ãƒœãƒ¼ãƒˆ | strawberry_boat | 3ãƒã‚¹ | ã‚¹ãƒˆãƒ­ãƒ™ãƒªãƒ¼ã‚·ãƒ¼ãƒ«ãƒ‰ | æ¬¡ã«å—ã‘ã‚‹æ”»æ’ƒã‚’1å›ç„¡åŠ¹åŒ– |
| ã‚³ã‚³ã‚¢æ½œæ°´è‰‡ | cocoa_submarine | 5ãƒã‚¹ | ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆãƒœãƒ  | 3Ã—3ã‚¨ãƒªã‚¢ï¼ˆ9ãƒã‚¹ï¼‰ã‚’æ”»æ’ƒ |
| ãƒã‚«ãƒ­ãƒ³å††ç›¤ | macaron_ufo | 2ãƒã‚¹ | ã‚¹ã‚¤ãƒ¼ãƒˆã‚¨ã‚¹ã‚±ãƒ¼ãƒ— | è‡ªåˆ†ã®ä¹—ã‚Šç‰©ã‚’åˆ¥ã®å ´æ‰€ã«ç§»å‹• |
| ãƒ¯ãƒƒãƒ•ãƒ«è‰¦ | waffle_ship | 4ãƒã‚¹ | æ ¼å­ã‚¹ã‚­ãƒ£ãƒ³ | ç¸¦1åˆ—oræ¨ª1åˆ—ã‚’ã‚¹ã‚­ãƒ£ãƒ³ |

**åˆè¨ˆãƒã‚¹æ•°**: 3 + 5 + 2 + 4 = **14ãƒã‚¹**

---

## ğŸ“ é…ç½®ãƒ•ã‚§ãƒ¼ã‚º

### é…ç½®ãƒ«ãƒ¼ãƒ«

#### 1. åŸºæœ¬ãƒ«ãƒ¼ãƒ«
- å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯è‡ªåˆ†ã®ãƒœãƒ¼ãƒ‰ï¼ˆ10Ã—10ãƒã‚¹ï¼‰ã«4éš»ã‚’é…ç½®
- ä¹—ã‚Šç‰©ã¯**ç¸¦ã¾ãŸã¯æ¨ª**ã«é…ç½®å¯èƒ½
- ä¹—ã‚Šç‰©åŒå£«ã®**éš£æ¥OK**ï¼ˆæœ€ä½è·é›¢åˆ¶é™ãªã—ï¼‰
- ãƒœãƒ¼ãƒ‰ã®ç¯„å›²å¤–ã«ã¯é…ç½®ä¸å¯
- ä¹—ã‚Šç‰©ã®é‡è¤‡é…ç½®ã¯ä¸å¯

#### 2. é…ç½®æ™‚é–“
- **ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¯¾æˆ¦**: 60ç§’ä»¥å†…
- **CPUå¯¾æˆ¦**: åˆ¶é™ãªã—

#### 3. ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚ã®æŒ™å‹•
é…ç½®ãŒå®Œäº†ã—ãªã‹ã£ãŸå ´åˆã€**ãƒ©ãƒ³ãƒ€ãƒ é…ç½®**ã‚’å®Ÿè¡Œï¼š
- æœªé…ç½®ã®ä¹—ã‚Šç‰©ã‚’è‡ªå‹•ã§é…ç½®
- é…ç½®å¯èƒ½ãªä½ç½®ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«é¸æŠ
- è¡çªã—ãªã„ã‚ˆã†ã«èª¿æ•´

---

### é…ç½®å‡¦ç†ãƒ•ãƒ­ãƒ¼

```
1. ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒä¹—ã‚Šç‰©ã‚’é¸æŠ
2. æ–¹å‘ã‚’é¸æŠï¼ˆç¸¦ or æ¨ªï¼‰
3. ãƒœãƒ¼ãƒ‰ä¸Šã®ãƒã‚¹ã‚’ã‚¯ãƒªãƒƒã‚¯
4. é…ç½®å¯èƒ½ã‹æ¤œè¨¼
   â”œâ”€ OK â†’ é…ç½®å®Ÿè¡Œ
   â””â”€ NG â†’ ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
5. å…¨ã¦é…ç½®å®Œäº† â†’ ã€Œé…ç½®å®Œäº†ã€ãƒœã‚¿ãƒ³æœ‰åŠ¹åŒ–
6. ã€Œé…ç½®å®Œäº†ã€æŠ¼ä¸‹ â†’ ç›¸æ‰‹ã‚’å¾…æ©Ÿ
7. ä¸¡è€…æº–å‚™å®Œäº† â†’ æˆ¦é—˜ãƒ•ã‚§ãƒ¼ã‚ºã¸
```

---

### é…ç½®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

```typescript
/**
 * ä¹—ã‚Šç‰©ã‚’é…ç½®å¯èƒ½ã‹æ¤œè¨¼
 * @param board ç¾åœ¨ã®ãƒœãƒ¼ãƒ‰çŠ¶æ…‹
 * @param ship é…ç½®ã™ã‚‹ä¹—ã‚Šç‰©
 * @param position é…ç½®é–‹å§‹ä½ç½®
 * @param direction é…ç½®æ–¹å‘
 * @returns é…ç½®å¯èƒ½ãªã‚‰true
 */
function canPlaceShip(
  board: (string | null)[][],
  ship: Ship,
  position: Position,
  direction: Direction
): boolean {
  const { x, y } = position;
  const { size } = ship;

  // ç¯„å›²å¤–ãƒã‚§ãƒƒã‚¯
  if (direction === 'horizontal') {
    if (x + size > 10) return false; // å³ã«ã¯ã¿å‡ºã™
  } else {
    if (y + size > 10) return false; // ä¸‹ã«ã¯ã¿å‡ºã™
  }

  // é‡è¤‡ãƒã‚§ãƒƒã‚¯
  for (let i = 0; i < size; i++) {
    const checkX = direction === 'horizontal' ? x + i : x;
    const checkY = direction === 'vertical' ? y + i : y;

    if (board[checkY][checkX] !== null) {
      return false; // æ—¢ã«åˆ¥ã®ä¹—ã‚Šç‰©ãŒã‚ã‚‹
    }
  }

  return true;
}
```

---

### é…ç½®å®Ÿè¡Œ

```typescript
/**
 * ä¹—ã‚Šç‰©ã‚’é…ç½®
 * @param board ãƒœãƒ¼ãƒ‰çŠ¶æ…‹
 * @param ship é…ç½®ã™ã‚‹ä¹—ã‚Šç‰©
 * @param position é…ç½®é–‹å§‹ä½ç½®
 * @param direction é…ç½®æ–¹å‘
 */
function placeShip(
  board: (string | null)[][],
  ship: Ship,
  position: Position,
  direction: Direction
): void {
  const { x, y } = position;
  const { size, id } = ship;

  // ãƒœãƒ¼ãƒ‰ã«ä¹—ã‚Šç‰©IDã‚’è¨˜éŒ²
  for (let i = 0; i < size; i++) {
    const placeX = direction === 'horizontal' ? x + i : x;
    const placeY = direction === 'vertical' ? y + i : y;
    board[placeY][placeX] = id; // ä¹—ã‚Šç‰©IDã‚’è¨˜éŒ²
  }

  // ä¹—ã‚Šç‰©ã®ä½ç½®æƒ…å ±ã‚’æ›´æ–°
  ship.position = position;
  ship.direction = direction;
}
```

---

## âš”ï¸ æˆ¦é—˜ãƒ•ã‚§ãƒ¼ã‚º

### ã‚¿ãƒ¼ãƒ³åˆ¶ã‚·ã‚¹ãƒ†ãƒ 

#### ã‚¿ãƒ¼ãƒ³ã®æµã‚Œ
```
ã€è‡ªåˆ†ã®ã‚¿ãƒ¼ãƒ³ã€‘
1. ã‚¿ãƒ¼ãƒ³é–‹å§‹
   â”œâ”€ ã‚¹ã‚­ãƒ«ä½¿ç”¨å¯èƒ½
   â””â”€ æ”»æ’ƒå¯èƒ½
2. æ”»æ’ƒé¸æŠ
   â””â”€ ç›¸æ‰‹ã®ãƒœãƒ¼ãƒ‰ã®ãƒã‚¹ã‚’ã‚¯ãƒªãƒƒã‚¯
3. æ”»æ’ƒåˆ¤å®š
   â”œâ”€ ãƒŸã‚¹ â†’ ç›¸æ‰‹ã®ã‚¿ãƒ¼ãƒ³ã¸
   â”œâ”€ ãƒ’ãƒƒãƒˆ â†’ é€£ç¶šæ”»æ’ƒå¯èƒ½ï¼ˆæ‰‹é †2ã¸æˆ»ã‚‹ï¼‰
   â””â”€ æ’ƒæ²ˆ â†’ é€£ç¶šæ”»æ’ƒå¯èƒ½ï¼ˆæ‰‹é †2ã¸æˆ»ã‚‹ï¼‰
4. ã‚¹ã‚­ãƒ«ä½¿ç”¨ï¼ˆä»»æ„ã€ã‚¿ãƒ¼ãƒ³ä¸­ã„ã¤ã§ã‚‚ï¼‰
5. ã‚¿ãƒ¼ãƒ³çµ‚äº†

ã€ç›¸æ‰‹ã®ã‚¿ãƒ¼ãƒ³ã€‘
1. ç›¸æ‰‹ã®æ”»æ’ƒã‚’å¾…æ©Ÿ
2. æ”»æ’ƒçµæœã‚’è¡¨ç¤º
3. è‡ªåˆ†ã®ãƒœãƒ¼ãƒ‰ã«åæ˜ 
```

#### ã‚¿ãƒ¼ãƒ³ãƒ•ã‚§ãƒ¼ã‚º
```typescript
enum TurnPhase {
  START = 'start',           // ã‚¿ãƒ¼ãƒ³é–‹å§‹
  ATTACK = 'attack',         // æ”»æ’ƒå¾…æ©Ÿä¸­
  AFTER_HIT = 'after_hit',   // å‘½ä¸­å¾Œï¼ˆé€£ç¶šæ”»æ’ƒå¯èƒ½ï¼‰
  SKILL_SELECT = 'skill_select', // ã‚¹ã‚­ãƒ«é¸æŠä¸­
  END = 'end'                // ã‚¿ãƒ¼ãƒ³çµ‚äº†
}
```

---

### æ”»æ’ƒå‡¦ç†

#### æ”»æ’ƒå¯èƒ½åˆ¤å®š
```typescript
/**
 * æŒ‡å®šã—ãŸãƒã‚¹ã«æ”»æ’ƒå¯èƒ½ã‹
 * @param position æ”»æ’ƒå¯¾è±¡ã®åº§æ¨™
 * @param attackedCells æ”»æ’ƒæ¸ˆã¿ãƒã‚¹ã®ã‚»ãƒƒãƒˆ
 * @returns æ”»æ’ƒå¯èƒ½ãªã‚‰true
 */
function canAttack(position: Position, attackedCells: Set<string>): boolean {
  const key = `${position.x}-${position.y}`;
  return !attackedCells.has(key); // æœªæ”»æ’ƒãªã‚‰true
}
```

---

#### æ”»æ’ƒå®Ÿè¡Œ

```typescript
/**
 * æ”»æ’ƒã‚’å®Ÿè¡Œ
 * @param position æ”»æ’ƒå¯¾è±¡ã®åº§æ¨™
 * @param defenderBoard é˜²å¾¡å´ã®ãƒœãƒ¼ãƒ‰
 * @param defenderShips é˜²å¾¡å´ã®ä¹—ã‚Šç‰©ãƒªã‚¹ãƒˆ
 * @param shieldActive é˜²å¾¡å´ã®ã‚·ãƒ¼ãƒ«ãƒ‰ãŒæœ‰åŠ¹ã‹
 * @returns æ”»æ’ƒçµæœ
 */
function executeAttack(
  position: Position,
  defenderBoard: (string | null)[][],
  defenderShips: Ship[],
  shieldActive: boolean
): AttackResult {
  const { x, y } = position;

  // ã‚·ãƒ¼ãƒ«ãƒ‰åˆ¤å®š
  if (shieldActive) {
    return {
      result: 'blocked',
      position,
      message: 'ã‚·ãƒ¼ãƒ«ãƒ‰ã§é˜²ãŒã‚ŒãŸï¼',
      canContinue: false, // ãƒŸã‚¹æ‰±ã„ã€ã‚¿ãƒ¼ãƒ³çµ‚äº†
    };
  }

  // ãƒ’ãƒƒãƒˆåˆ¤å®š
  const shipId = defenderBoard[y][x];

  if (shipId === null) {
    // ãƒŸã‚¹
    return {
      result: 'miss',
      position,
      message: 'ãƒŸã‚¹ï¼',
      canContinue: false, // ã‚¿ãƒ¼ãƒ³çµ‚äº†
    };
  }

  // ãƒ’ãƒƒãƒˆ
  const hitShip = defenderShips.find(s => s.id === shipId);
  if (!hitShip) throw new Error('Ship not found');

  // è¢«å¼¾ä½ç½®ã‚’è¨ˆç®—
  const hitIndex = calculateHitIndex(hitShip, position);
  hitShip.hits[hitIndex] = true;

  // æ’ƒæ²ˆåˆ¤å®š
  const isSunk = hitShip.hits.every(h => h === true);
  if (isSunk) {
    hitShip.sunk = true;
    return {
      result: 'sunk',
      position,
      shipId: hitShip.id,
      shipType: hitShip.type,
      message: `${hitShip.type} æ’ƒæ²ˆï¼`,
      canContinue: true, // é€£ç¶šæ”»æ’ƒå¯èƒ½
    };
  }

  return {
    result: 'hit',
    position,
    shipId: hitShip.id,
    shipType: hitShip.type,
    message: 'ãƒ’ãƒƒãƒˆï¼',
    canContinue: true, // é€£ç¶šæ”»æ’ƒå¯èƒ½
  };
}
```

---

#### è¢«å¼¾ä½ç½®ã®è¨ˆç®—

```typescript
/**
 * è¢«å¼¾ã—ãŸãƒã‚¹ãŒä¹—ã‚Šç‰©ã®ã©ã®ä½ç½®ã‹è¨ˆç®—
 * @param ship ä¹—ã‚Šç‰©
 * @param hitPosition è¢«å¼¾åº§æ¨™
 * @returns è¢«å¼¾ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆ0 ~ size-1ï¼‰
 */
function calculateHitIndex(ship: Ship, hitPosition: Position): number {
  if (!ship.position) throw new Error('Ship not placed');

  const { x: shipX, y: shipY } = ship.position;
  const { x: hitX, y: hitY } = hitPosition;
  const { direction } = ship;

  if (direction === 'horizontal') {
    return hitX - shipX;
  } else {
    return hitY - shipY;
  }
}
```

---

### æ”»æ’ƒæ¸ˆã¿ãƒã‚¹ã®ç®¡ç†

```typescript
/**
 * æ”»æ’ƒæ¸ˆã¿ãƒã‚¹ã‚’è¨˜éŒ²
 * @param position æ”»æ’ƒã—ãŸåº§æ¨™
 * @param attackedCells æ”»æ’ƒæ¸ˆã¿ã‚»ãƒƒãƒˆ
 */
function markAsAttacked(position: Position, attackedCells: Set<string>): void {
  const key = `${position.x}-${position.y}`;
  attackedCells.add(key);
}
```

---

## ğŸ’ª ã‚¹ã‚­ãƒ«ã‚·ã‚¹ãƒ†ãƒ 

### ã‚¹ã‚­ãƒ«å…±é€šãƒ«ãƒ¼ãƒ«
1. **å„ã‚¹ã‚­ãƒ«ã¯1è©¦åˆã«1å›ã®ã¿ä½¿ç”¨å¯èƒ½**
2. **ãã®ä¹—ã‚Šç‰©ãŒæ’ƒæ²ˆã•ã‚ŒãŸã‚‰ã‚¹ã‚­ãƒ«ä½¿ç”¨ä¸å¯**
3. **ã‚¹ã‚­ãƒ«ä½¿ç”¨ã¯è‡ªåˆ†ã®ã‚¿ãƒ¼ãƒ³ä¸­ã®ã¿**ï¼ˆã‚¿ãƒ¼ãƒ³é–‹å§‹æ™‚ or æ”»æ’ƒå¾Œï¼‰
4. **ã‚¹ã‚­ãƒ«ä½¿ç”¨ã¯ç›¸æ‰‹ã«è¦‹ãˆã‚‹**ï¼ˆæ¼”å‡ºã§è¡¨ç¤ºï¼‰

---

### ã‚¹ã‚­ãƒ«è©³ç´°ä»•æ§˜

#### 1. ã‚¹ãƒˆãƒ­ãƒ™ãƒªãƒ¼ã‚·ãƒ¼ãƒ«ãƒ‰ï¼ˆã‚¤ãƒã‚´ãƒœãƒ¼ãƒˆï¼‰

**åŠ¹æœ**: æ¬¡ã«è‡ªåˆ†ãŒå—ã‘ã‚‹æ”»æ’ƒã‚’1å›ã ã‘ç„¡åŠ¹åŒ–

**ä½¿ç”¨ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: è‡ªåˆ†ã®ã‚¿ãƒ¼ãƒ³ä¸­

**å®Ÿè£…**:
```typescript
function useStrawberryShield(playerState: PlayerState): SkillResult {
  // ã‚·ãƒ¼ãƒ«ãƒ‰ãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹
  playerState.shieldActive = true;

  return {
    success: true,
    effect: 'æ¬¡ã®æ”»æ’ƒã‚’ç„¡åŠ¹åŒ–ã™ã‚‹ã‚·ãƒ¼ãƒ«ãƒ‰ã‚’å±•é–‹ã—ã¾ã—ãŸï¼',
  };
}
```

**æ³¨æ„ç‚¹**:
- ã‚·ãƒ¼ãƒ«ãƒ‰ã¯**æ¬¡ã®1å›ã®æ”»æ’ƒã®ã¿**ç„¡åŠ¹åŒ–
- æ”»æ’ƒã‚’å—ã‘ãŸã‚‰ã‚·ãƒ¼ãƒ«ãƒ‰ã¯è‡ªå‹•è§£é™¤
- ç›¸æ‰‹ã«ã¯ã€Œã„ã¤ä½¿ã£ãŸã‹ã€ãŒè¦‹ãˆã‚‹ï¼ˆæ¼”å‡ºã§è¡¨ç¤ºï¼‰
- è‡ªåˆ†ã®ã‚¿ãƒ¼ãƒ³çµ‚äº†å¾Œã‚‚æŒç¶š

---

#### 2. ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆãƒœãƒ ï¼ˆã‚³ã‚³ã‚¢æ½œæ°´è‰‡ï¼‰

**åŠ¹æœ**: æŒ‡å®šã—ãŸ3Ã—3ã‚¨ãƒªã‚¢ï¼ˆ9ãƒã‚¹ï¼‰ã‚’ä¸€æ°—ã«æ”»æ’ƒ

**ä½¿ç”¨ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: è‡ªåˆ†ã®ã‚¿ãƒ¼ãƒ³ä¸­

**å®Ÿè£…**:
```typescript
function useChocolateBomb(
  centerPosition: Position,
  defenderBoard: (string | null)[][],
  defenderShips: Ship[],
  attackedCells: Set<string>
): SkillResult {
  const results: AttackResult[] = [];
  
  // 3Ã—3ã‚¨ãƒªã‚¢ã®å„ãƒã‚¹ã‚’æ”»æ’ƒ
  for (let dy = -1; dy <= 1; dy++) {
    for (let dx = -1; dx <= 1; dx++) {
      const targetX = centerPosition.x + dx;
      const targetY = centerPosition.y + dy;

      // ç¯„å›²å¤–ãƒã‚§ãƒƒã‚¯
      if (targetX < 0 || targetX >= 10 || targetY < 0 || targetY >= 10) {
        continue;
      }

      const target = { x: targetX, y: targetY };

      // æ”»æ’ƒæ¸ˆã¿ãƒã‚§ãƒƒã‚¯
      if (canAttack(target, attackedCells)) {
        const result = executeAttack(target, defenderBoard, defenderShips, false);
        results.push(result);
        markAsAttacked(target, attackedCells);
      }
    }
  }

  return {
    success: true,
    effect: `ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆãƒœãƒ ã§${results.length}ãƒã‚¹ã‚’æ”»æ’ƒã—ã¾ã—ãŸï¼`,
    data: { results },
  };
}
```

**æ³¨æ„ç‚¹**:
- ä¸­å¿ƒåº§æ¨™ã‚’æŒ‡å®šã™ã‚‹ã¨ã€ãã®å‘¨å›²8ãƒã‚¹ï¼‹ä¸­å¿ƒã®è¨ˆ9ãƒã‚¹ã‚’æ”»æ’ƒ
- ãƒœãƒ¼ãƒ‰ã®ç¯„å›²å¤–ã¯ç„¡è¦–
- æ—¢ã«æ”»æ’ƒæ¸ˆã¿ã®ãƒã‚¹ã¯ã‚¹ã‚­ãƒƒãƒ—
- é€£ç¶šæ”»æ’ƒã®æ¨©åˆ©ã¯**ãªã—**ï¼ˆã‚¹ã‚­ãƒ«ä½¿ç”¨å¾Œã¯ã‚¿ãƒ¼ãƒ³çµ‚äº†ï¼‰

---

#### 3. ã‚¹ã‚¤ãƒ¼ãƒˆã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ï¼ˆãƒã‚«ãƒ­ãƒ³å††ç›¤ï¼‰

**åŠ¹æœ**: è‡ªåˆ†ã®ä¹—ã‚Šç‰©ã‚’1éš»ã ã‘åˆ¥ã®å ´æ‰€ã«ç§»å‹•

**ä½¿ç”¨ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: è‡ªåˆ†ã®ã‚¿ãƒ¼ãƒ³ä¸­

**å®Ÿè£…**:
```typescript
function useSweetEscape(
  ship: Ship,
  newPosition: Position,
  newDirection: Direction,
  board: (string | null)[][]
): SkillResult {
  // å…ƒã®ä½ç½®ã‚’ã‚¯ãƒªã‚¢
  if (ship.position) {
    clearShipFromBoard(board, ship);
  }

  // æ–°ã—ã„ä½ç½®ã«é…ç½®å¯èƒ½ã‹æ¤œè¨¼
  if (!canPlaceShip(board, ship, newPosition, newDirection)) {
    return {
      success: false,
      effect: 'ãã®å ´æ‰€ã«ã¯ç§»å‹•ã§ãã¾ã›ã‚“',
    };
  }

  // ç§»å‹•å®Ÿè¡Œ
  placeShip(board, ship, newPosition, newDirection);

  // è¢«å¼¾æƒ…å ±ã¯ãã®ã¾ã¾ï¼ˆhitsé…åˆ—ã¯ä¿æŒï¼‰

  return {
    success: true,
    effect: `${ship.type} ã‚’ç§»å‹•ã—ã¾ã—ãŸï¼`,
  };
}

/**
 * ãƒœãƒ¼ãƒ‰ã‹ã‚‰ä¹—ã‚Šç‰©ã‚’å‰Šé™¤
 */
function clearShipFromBoard(board: (string | null)[][], ship: Ship): void {
  if (!ship.position) return;

  const { x, y } = ship.position;
  const { size, direction } = ship;

  for (let i = 0; i < size; i++) {
    const clearX = direction === 'horizontal' ? x + i : x;
    const clearY = direction === 'vertical' ? y + i : y;
    board[clearY][clearX] = null;
  }
}
```

**æ³¨æ„ç‚¹**:
- ç§»å‹•å…ˆãŒé…ç½®å¯èƒ½ãªä½ç½®ã§ãªã‘ã‚Œã°å¤±æ•—
- è¢«å¼¾æƒ…å ±ï¼ˆhitsé…åˆ—ï¼‰ã¯å¼•ãç¶™ã
- ç§»å‹•å¾Œã®ä½ç½®ã¯ç›¸æ‰‹ã«ã¯è¦‹ãˆãªã„ï¼ˆè‡ªåˆ†ã®ãƒœãƒ¼ãƒ‰ã¯è¦‹ãˆãªã„ä»•æ§˜ï¼‰

---

#### 4. æ ¼å­ã‚¹ã‚­ãƒ£ãƒ³ï¼ˆãƒ¯ãƒƒãƒ•ãƒ«è‰¦ï¼‰

**åŠ¹æœ**: ç¸¦1åˆ—ã¾ãŸã¯æ¨ª1åˆ—ï¼ˆ10ãƒã‚¹ï¼‰ã‚’ä¸€æ°—ã«ã‚¹ã‚­ãƒ£ãƒ³ã€æ•µãŒã„ã‚‹ã‹ç¢ºèª

**ä½¿ç”¨ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: è‡ªåˆ†ã®ã‚¿ãƒ¼ãƒ³ä¸­

**å®Ÿè£…**:
```typescript
function useWaffleScan(
  line: 'row' | 'col',
  lineIndex: number,
  defenderBoard: (string | null)[][]
): SkillResult {
  const hitPositions: Position[] = [];

  if (line === 'row') {
    // æ¨ª1åˆ—ã‚’ã‚¹ã‚­ãƒ£ãƒ³ï¼ˆy = lineIndex ã®å…¨xï¼‰
    for (let x = 0; x < 10; x++) {
      if (defenderBoard[lineIndex][x] !== null) {
        hitPositions.push({ x, y: lineIndex });
      }
    }
  } else {
    // ç¸¦1åˆ—ã‚’ã‚¹ã‚­ãƒ£ãƒ³ï¼ˆx = lineIndex ã®å…¨yï¼‰
    for (let y = 0; y < 10; y++) {
      if (defenderBoard[y][lineIndex] !== null) {
        hitPositions.push({ x: lineIndex, y });
      }
    }
  }

  return {
    success: true,
    effect: `ã‚¹ã‚­ãƒ£ãƒ³å®Œäº†ï¼š${hitPositions.length}ãƒã‚¹ã«æ•µã‚’ç™ºè¦‹ï¼`,
    data: { hitPositions },
  };
}
```

**æ³¨æ„ç‚¹**:
- æ•µãŒã„ã‚‹ãƒã‚¹ã®**åº§æ¨™ã‚’å–å¾—**ï¼ˆã©ã®ä¹—ã‚Šç‰©ã‹ã¯ä¸æ˜ï¼‰
- æ”»æ’ƒã¯ã—ãªã„ï¼ˆã‚¹ã‚­ãƒ£ãƒ³ã®ã¿ï¼‰
- ã‚¹ã‚­ãƒ£ãƒ³çµæœã¯UIã§ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤ºï¼ˆä¾‹ï¼šèµ¤æ ï¼‰
- ã‚¹ã‚­ãƒ£ãƒ³å¾Œã‚‚æ”»æ’ƒã¯å¯èƒ½

---

## ğŸ† å‹æ•—åˆ¤å®š

### å‹åˆ©æ¡ä»¶
**ç›¸æ‰‹ã®ä¹—ã‚Šç‰©ã‚’å…¨ã¦æ’ƒæ²ˆã—ãŸã‚‰å‹åˆ©**

### åˆ¤å®šå‡¦ç†

```typescript
/**
 * å‹æ•—åˆ¤å®š
 * @param ships å¯¾è±¡ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ä¹—ã‚Šç‰©ãƒªã‚¹ãƒˆ
 * @returns å…¨æ»…ã—ã¦ã„ã‚Œã°true
 */
function checkDefeat(ships: Ship[]): boolean {
  return ships.every(ship => ship.sunk);
}

/**
 * ã‚²ãƒ¼ãƒ çµ‚äº†åˆ¤å®š
 * @param gameState ã‚²ãƒ¼ãƒ çŠ¶æ…‹
 * @returns å‹è€…ã®PlayerIdã€ã¾ã ç¶šè¡Œä¸­ãªã‚‰null
 */
function checkGameEnd(gameState: GameState): PlayerId | null {
  const { player1, player2 } = gameState.players;

  if (checkDefeat(player1.ships)) {
    return 'player2'; // player1æ•—åŒ— â†’ player2å‹åˆ©
  }

  if (checkDefeat(player2.ships)) {
    return 'player1'; // player2æ•—åŒ— â†’ player1å‹åˆ©
  }

  return null; // ã¾ã ç¶šè¡Œä¸­
}
```

---

## ğŸ“Š ä½“åŠ›ï¼ˆHPï¼‰ã‚·ã‚¹ãƒ†ãƒ 

### è¨ˆç®—æ–¹æ³•
**æ®‹ã‚Šä½“åŠ›% = (æ®‹å­˜ãƒã‚¹æ•° / ç·ãƒã‚¹æ•°) Ã— 100**

### å®Ÿè£…

```typescript
/**
 * HPã‚’è¨ˆç®—
 * @param ships ä¹—ã‚Šç‰©ãƒªã‚¹ãƒˆ
 * @returns HPï¼ˆãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸ï¼‰
 */
function calculateHP(ships: Ship[]): number {
  const totalMasses = ships.reduce((sum, ship) => sum + ship.size, 0); // 14
  const remainingMasses = ships.reduce((sum, ship) => {
    const hitCount = ship.hits.filter(h => h).length;
    return sum + (ship.size - hitCount);
  }, 0);

  return Math.round((remainingMasses / totalMasses) * 100);
}

/**
 * æ®‹å­˜ãƒã‚¹æ•°ã‚’è¨ˆç®—
 * @param ships ä¹—ã‚Šç‰©ãƒªã‚¹ãƒˆ
 * @returns æ®‹å­˜ãƒã‚¹æ•°
 */
function calculateRemainingMasses(ships: Ship[]): number {
  return ships.reduce((sum, ship) => {
    const hitCount = ship.hits.filter(h => h).length;
    return sum + (ship.size - hitCount);
  }, 0);
}
```

### è¡¨ç¤ºä¾‹
```
ã€ã‚ãªãŸã€‘
HP: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 79% (11/14ãƒã‚¹)
æ®‹å­˜è‰¦ï¼šå¤§å‹è‰¦Ã—1ã€ä¸­å‹è‰¦Ã—0ã€å°å‹è‰¦Ã—1ã€åµå¯Ÿè‰¦Ã—1

ã€ç›¸æ‰‹ã€‘
HP: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ 57% (8/14ãƒã‚¹)
æ®‹å­˜è‰¦ï¼šå¤§å‹è‰¦Ã—0ã€ä¸­å‹è‰¦Ã—1ã€å°å‹è‰¦Ã—1ã€åµå¯Ÿè‰¦Ã—1
```

---

## ğŸ¤– CPUå¯¾æˆ¦AI

### é›£æ˜“åº¦ï¼šç°¡æ˜“ç‰ˆï¼ˆMVPï¼‰

#### æ€è€ƒã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

##### ãƒ•ã‚§ãƒ¼ã‚º1ï¼šãƒ©ãƒ³ãƒ€ãƒ æ”»æ’ƒ
```typescript
/**
 * ãƒ©ãƒ³ãƒ€ãƒ ã«æ”»æ’ƒå¯¾è±¡ã‚’é¸æŠ
 * @param attackedCells æ”»æ’ƒæ¸ˆã¿ãƒã‚¹ã®ã‚»ãƒƒãƒˆ
 * @returns æ”»æ’ƒå¯¾è±¡ã®åº§æ¨™
 */
function selectRandomTarget(attackedCells: Set<string>): Position {
  const availableCells: Position[] = [];

  for (let y = 0; y < 10; y++) {
    for (let x = 0; x < 10; x++) {
      const key = `${x}-${y}`;
      if (!attackedCells.has(key)) {
        availableCells.push({ x, y });
      }
    }
  }

  // ãƒ©ãƒ³ãƒ€ãƒ ã«1ã¤é¸æŠ
  const randomIndex = Math.floor(Math.random() * availableCells.length);
  return availableCells[randomIndex];
}
```

##### ãƒ•ã‚§ãƒ¼ã‚º2ï¼šãƒ’ãƒƒãƒˆæ™‚ã®å‘¨å›²æ”»æ’ƒ
```typescript
/**
 * æœ€å¾Œã«ãƒ’ãƒƒãƒˆã—ãŸãƒã‚¹ã®å‘¨å›²ã‚’ç‹™ã†
 * @param lastHit æœ€å¾Œã«ãƒ’ãƒƒãƒˆã—ãŸåº§æ¨™
 * @param attackedCells æ”»æ’ƒæ¸ˆã¿ãƒã‚¹ã®ã‚»ãƒƒãƒˆ
 * @returns æ¬¡ã®æ”»æ’ƒå¯¾è±¡
 */
function selectAdjacentTarget(
  lastHit: Position,
  attackedCells: Set<string>
): Position | null {
  const { x, y } = lastHit;
  const adjacent = [
    { x: x - 1, y },     // å·¦
    { x: x + 1, y },     // å³
    { x, y: y - 1 },     // ä¸Š
    { x, y: y + 1 },     // ä¸‹
  ];

  // ç¯„å›²å†… & æœªæ”»æ’ƒã®ãƒã‚¹ã‚’ãƒ•ã‚£ãƒ«ã‚¿
  const validTargets = adjacent.filter(pos => {
    if (pos.x < 0 || pos.x >= 10 || pos.y < 0 || pos.y >= 10) return false;
    const key = `${pos.x}-${pos.y}`;
    return !attackedCells.has(key);
  });

  if (validTargets.length === 0) return null;

  // ãƒ©ãƒ³ãƒ€ãƒ ã«1ã¤é¸æŠ
  const randomIndex = Math.floor(Math.random() * validTargets.length);
  return validTargets[randomIndex];
}
```

##### CPUæ€è€ƒã®ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯
```typescript
class SimpleCPU {
  private lastHit: Position | null = null;

  selectTarget(attackedCells: Set<string>): Position {
    // ãƒ’ãƒƒãƒˆå¾Œãªã‚‰å‘¨å›²ã‚’ç‹™ã†
    if (this.lastHit) {
      const adjacent = selectAdjacentTarget(this.lastHit, attackedCells);
      if (adjacent) {
        return adjacent;
      } else {
        // å‘¨å›²ã«æ”»æ’ƒå¯èƒ½ãªãƒã‚¹ãŒãªã„ â†’ ãƒ©ãƒ³ãƒ€ãƒ ã«æˆ»ã‚‹
        this.lastHit = null;
      }
    }

    // ãƒ©ãƒ³ãƒ€ãƒ æ”»æ’ƒ
    return selectRandomTarget(attackedCells);
  }

  onAttackResult(result: AttackResult): void {
    if (result.result === 'hit') {
      this.lastHit = result.position; // æ¬¡ã¯å‘¨å›²ã‚’ç‹™ã†
    } else if (result.result === 'sunk') {
      this.lastHit = null; // æ’ƒæ²ˆã—ãŸã‚‰ãƒªã‚»ãƒƒãƒˆ
    } else {
      this.lastHit = null; // ãƒŸã‚¹ or ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚ŒãŸã‚‰ãƒªã‚»ãƒƒãƒˆ
    }
  }

  shouldUseSkill(gameState: GameState): boolean {
    // ç°¡æ˜“åˆ¤å®šï¼šHP50%ä»¥ä¸‹ã§æ”»æ’ƒç³»ã‚¹ã‚­ãƒ«ã‚’ä½¿ç”¨
    const cpuPlayer = gameState.players.player2; // CPUã¯player2ã¨ä»®å®š
    const hp = calculateHP(cpuPlayer.ships);

    if (hp <= 50) {
      // ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆãƒœãƒ ãŒä½¿ç”¨å¯èƒ½ã‹
      const cocoaSubmarine = cpuPlayer.ships.find(s => s.type === 'cocoa_submarine');
      if (cocoaSubmarine && !cocoaSubmarine.skillUsed && !cocoaSubmarine.sunk) {
        return true;
      }
    }

    return false;
  }
}
```

---

### CPUé…ç½®AI

```typescript
/**
 * CPUãŒä¹—ã‚Šç‰©ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«é…ç½®
 * @param ships é…ç½®ã™ã‚‹ä¹—ã‚Šç‰©ãƒªã‚¹ãƒˆ
 * @param board ãƒœãƒ¼ãƒ‰
 */
function placeCPUShips(ships: Ship[], board: (string | null)[][]): void {
  for (const ship of ships) {
    let placed = false;

    while (!placed) {
      // ãƒ©ãƒ³ãƒ€ãƒ ãªä½ç½®ã¨æ–¹å‘
      const x = Math.floor(Math.random() * 10);
      const y = Math.floor(Math.random() * 10);
      const direction = Math.random() > 0.5 ? 'horizontal' : 'vertical';
      const position = { x, y };

      // é…ç½®å¯èƒ½ã‹æ¤œè¨¼
      if (canPlaceShip(board, ship, position, direction)) {
        placeShip(board, ship, position, direction);
        placed = true;
      }
    }
  }
}
```

---

## ğŸ”„ ã‚²ãƒ¼ãƒ ãƒ•ãƒ­ãƒ¼ï¼ˆå…¨ä½“ï¼‰

### åˆæœŸåŒ–

```typescript
/**
 * ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’åˆæœŸåŒ–
 * @param mode ã‚²ãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰
 * @param player1Character player1ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼
 * @param player2Character player2ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼
 * @returns åˆæœŸåŒ–ã•ã‚ŒãŸGameState
 */
function initializeGame(
  mode: GameMode,
  player1Character: CharacterType,
  player2Character: CharacterType
): GameState {
  return {
    gameId: generateGameId(),
    mode,
    phase: 'setup',
    turnPhase: 'start',
    currentTurn: 'player1', // player1ãŒå…ˆæ”»
    players: {
      player1: createPlayerState('player1', player1Character),
      player2: createPlayerState('player2', player2Character),
    },
    attackedCells: {
      player1: new Set(),
      player2: new Set(),
    },
    winner: null,
    turnCount: 0,
    setupTimer: 60, // 60ç§’
  };
}

/**
 * ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼çŠ¶æ…‹ã‚’ä½œæˆ
 */
function createPlayerState(id: PlayerId, character: CharacterType): PlayerState {
  return {
    id,
    character,
    ships: createShips(id), // 4éš»ã®ä¹—ã‚Šç‰©ã‚’ç”Ÿæˆ
    board: createEmptyBoard(),
    hp: 100,
    remainingMasses: 14,
    totalMasses: 14,
    shieldActive: false,
    activeSkills: [],
    isReady: false,
  };
}

/**
 * ç©ºã®ãƒœãƒ¼ãƒ‰ã‚’ä½œæˆ
 */
function createEmptyBoard(): (string | null)[][] {
  return Array.from({ length: 10 }, () => Array(10).fill(null));
}

/**
 * ä¹—ã‚Šç‰©ãƒªã‚¹ãƒˆã‚’ç”Ÿæˆ
 */
function createShips(playerId: PlayerId): Ship[] {
  return [
    {
      id: `${playerId}_strawberry_boat`,
      type: 'strawberry_boat',
      size: 3,
      position: null,
      direction: 'horizontal',
      hits: [false, false, false],
      sunk: false,
      skillUsed: false,
    },
    {
      id: `${playerId}_cocoa_submarine`,
      type: 'cocoa_submarine',
      size: 5,
      position: null,
      direction: 'horizontal',
      hits: [false, false, false, false, false],
      sunk: false,
      skillUsed: false,
    },
    {
      id: `${playerId}_macaron_ufo`,
      type: 'macaron_ufo',
      size: 2,
      position: null,
      direction: 'horizontal',
      hits: [false, false],
      sunk: false,
      skillUsed: false,
    },
    {
      id: `${playerId}_waffle_ship`,
      type: 'waffle_ship',
      size: 4,
      position: null,
      direction: 'horizontal',
      hits: [false, false, false, false],
      sunk: false,
      skillUsed: false,
    },
  ];
}
```

---

### é…ç½®ãƒ•ã‚§ãƒ¼ã‚º â†’ æˆ¦é—˜ãƒ•ã‚§ãƒ¼ã‚º

```typescript
/**
 * é…ç½®å®Œäº†ã‚’ç¢ºèª
 * @param gameState ã‚²ãƒ¼ãƒ çŠ¶æ…‹
 */
function checkSetupComplete(gameState: GameState): void {
  const { player1, player2 } = gameState.players;

  if (player1.isReady && player2.isReady) {
    // ä¸¡è€…æº–å‚™å®Œäº† â†’ æˆ¦é—˜ãƒ•ã‚§ãƒ¼ã‚ºã¸
    gameState.phase = 'battle';
    gameState.turnPhase = 'start';
    gameState.currentTurn = 'player1'; // player1ãŒå…ˆæ”»
  }
}
```

---

### ã‚¿ãƒ¼ãƒ³å‡¦ç†

```typescript
/**
 * ã‚¿ãƒ¼ãƒ³ã‚’é€²ã‚ã‚‹
 * @param gameState ã‚²ãƒ¼ãƒ çŠ¶æ…‹
 * @param action ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
 * @returns æ›´æ–°ã•ã‚ŒãŸGameState
 */
function processTurn(gameState: GameState, action: GameAction): GameState {
  const { currentTurn, players } = gameState;
  const attacker = players[currentTurn];
  const defender = players[currentTurn === 'player1' ? 'player2' : 'player1'];

  if (action.type === 'attack') {
    // æ”»æ’ƒå‡¦ç†
    const position = (action.data as AttackActionData).position;

    // æ”»æ’ƒå¯èƒ½ã‹æ¤œè¨¼
    if (!canAttack(position, gameState.attackedCells[currentTurn])) {
      throw new Error('Already attacked this position');
    }

    // æ”»æ’ƒå®Ÿè¡Œ
    const result = executeAttack(
      position,
      defender.board,
      defender.ships,
      defender.shieldActive
    );

    // ã‚·ãƒ¼ãƒ«ãƒ‰è§£é™¤
    if (defender.shieldActive && result.result === 'blocked') {
      defender.shieldActive = false;
    }

    // æ”»æ’ƒæ¸ˆã¿ãƒãƒ¼ã‚¯ã‚’è¨˜éŒ²
    markAsAttacked(position, gameState.attackedCells[currentTurn]);

    // HPæ›´æ–°
    defender.hp = calculateHP(defender.ships);
    defender.remainingMasses = calculateRemainingMasses(defender.ships);

    // å‹æ•—åˆ¤å®š
    const winner = checkGameEnd(gameState);
    if (winner) {
      gameState.winner = winner;
      gameState.phase = 'finished';
      return gameState;
    }

    // ã‚¿ãƒ¼ãƒ³ç¶™ç¶šåˆ¤å®š
    if (result.canContinue) {
      // ãƒ’ãƒƒãƒˆ or æ’ƒæ²ˆ â†’ é€£ç¶šæ”»æ’ƒå¯èƒ½
      gameState.turnPhase = 'after_hit';
    } else {
      // ãƒŸã‚¹ or ãƒ–ãƒ­ãƒƒã‚¯ â†’ ã‚¿ãƒ¼ãƒ³äº¤ä»£
      endTurn(gameState);
    }

  } else if (action.type === 'useSkill') {
    // ã‚¹ã‚­ãƒ«ä½¿ç”¨å‡¦ç†
    const skillData = (action.data as SkillActionData).skillUse;
    executeSkill(gameState, skillData);

    // ã‚¹ã‚­ãƒ«ä½¿ç”¨å¾Œã¯ã‚¿ãƒ¼ãƒ³ç¶™ç¶šï¼ˆæ”»æ’ƒå¯èƒ½ï¼‰
    gameState.turnPhase = 'attack';

  } else if (action.type === 'endTurn') {
    // æ‰‹å‹•ã§ã‚¿ãƒ¼ãƒ³çµ‚äº†
    endTurn(gameState);
  }

  gameState.lastAction = action;
  return gameState;
}

/**
 * ã‚¿ãƒ¼ãƒ³ã‚’çµ‚äº†ã—ã€ç›¸æ‰‹ã®ã‚¿ãƒ¼ãƒ³ã«åˆ‡ã‚Šæ›¿ãˆ
 */
function endTurn(gameState: GameState): void {
  gameState.currentTurn = gameState.currentTurn === 'player1' ? 'player2' : 'player1';
  gameState.turnPhase = 'start';
  gameState.turnCount++;
}
```

---

### ã‚¹ã‚­ãƒ«å®Ÿè¡Œçµ±åˆ

```typescript
/**
 * ã‚¹ã‚­ãƒ«ã‚’å®Ÿè¡Œ
 * @param gameState ã‚²ãƒ¼ãƒ çŠ¶æ…‹
 * @param skillUse ã‚¹ã‚­ãƒ«ä½¿ç”¨ãƒ‡ãƒ¼ã‚¿
 */
function executeSkill(gameState: GameState, skillUse: SkillUseData): SkillResult {
  const { skillId, shipId } = skillUse;
  const attacker = gameState.players[gameState.currentTurn];
  const defender = gameState.players[gameState.currentTurn === 'player1' ? 'player2' : 'player1'];

  // ä½¿ç”¨ã™ã‚‹ä¹—ã‚Šç‰©ã‚’å–å¾—
  const ship = attacker.ships.find(s => s.id === shipId);
  if (!ship) throw new Error('Ship not found');
  if (ship.sunk) throw new Error('Ship is sunk');
  if (ship.skillUsed) throw new Error('Skill already used');

  let result: SkillResult;

  // ã‚¹ã‚­ãƒ«IDã«å¿œã˜ã¦å®Ÿè¡Œ
  switch (skillId) {
    case 'strawberry_shield':
      result = useStrawberryShield(attacker);
      break;

    case 'chocolate_bomb':
      if (!skillUse.target) throw new Error('Target required for Chocolate Bomb');
      result = useChocolateBomb(
        skillUse.target,
        defender.board,
        defender.ships,
        gameState.attackedCells[gameState.currentTurn]
      );
      // HPæ›´æ–°
      defender.hp = calculateHP(defender.ships);
      defender.remainingMasses = calculateRemainingMasses(defender.ships);
      break;

    case 'sweet_escape':
      if (!skillUse.target) throw new Error('Target required for Sweet Escape');
      if (!skillUse.area) throw new Error('Direction required for Sweet Escape');
      // æ–¹å‘ã‚’å–å¾—ï¼ˆdataã‹ã‚‰ï¼‰
      const newDirection: Direction = 'horizontal'; // å®Ÿéš›ã«ã¯UIã‹ã‚‰å–å¾—
      result = useSweetEscape(ship, skillUse.target, newDirection, attacker.board);
      break;

    case 'waffle_scan':
      if (!skillUse.line || skillUse.lineIndex === undefined) {
        throw new Error('Line and lineIndex required for Waffle Scan');
      }
      result = useWaffleScan(skillUse.line, skillUse.lineIndex, defender.board);
      break;

    default:
      throw new Error('Unknown skill');
  }

  // ã‚¹ã‚­ãƒ«ä½¿ç”¨æ¸ˆã¿ãƒ•ãƒ©ã‚°
  ship.skillUsed = true;
  attacker.activeSkills.push(skillId);

  return result;
}
```

---

## ğŸ“ˆ ã‚²ãƒ¼ãƒ ãƒãƒ©ãƒ³ã‚¹èª¿æ•´æ¡ˆ

### å°†æ¥çš„ãªèª¿æ•´ãƒã‚¤ãƒ³ãƒˆ

#### ã‚¹ã‚­ãƒ«ã®å¼·ã•èª¿æ•´
- **ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆãƒœãƒ **: 3Ã—3 â†’ 2Ã—2 ã«ç¸®å°ï¼Ÿ
- **æ ¼å­ã‚¹ã‚­ãƒ£ãƒ³**: 10ãƒã‚¹ â†’ 4Ã—4ã‚¨ãƒªã‚¢ ã«å¤‰æ›´ï¼Ÿ
- **ã‚¹ãƒˆãƒ­ãƒ™ãƒªãƒ¼ã‚·ãƒ¼ãƒ«ãƒ‰**: 1å›ç„¡åŠ¹åŒ– â†’ 1ã‚¿ãƒ¼ãƒ³å…¨ç„¡åŠ¹åŒ–ï¼Ÿ

#### ãƒãƒƒãƒ—ã‚µã‚¤ã‚º
- 10Ã—10 â†’ 8Ã—8 or 12Ã—12 ã‚‚æ¤œè¨

#### ä¹—ã‚Šç‰©ã®ã‚µã‚¤ã‚º
- ç¾åœ¨ã®åˆè¨ˆ14ãƒã‚¹ â†’ 15ãƒã‚¹ã«å¢—ã‚„ã™ï¼Ÿ
- å°å‹è‰¦ã‚’1éš»è¿½åŠ ï¼Ÿ

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

### é…ç½®ãƒ•ã‚§ãƒ¼ã‚º

| ãƒ†ã‚¹ãƒˆé …ç›® | å…¥åŠ› | æœŸå¾…çµæœ |
|-----------|------|---------|
| æ­£å¸¸é…ç½®ï¼ˆæ¨ªï¼‰ | position: (0,0), direction: horizontal, size: 3 | é…ç½®æˆåŠŸ |
| æ­£å¸¸é…ç½®ï¼ˆç¸¦ï¼‰ | position: (0,0), direction: vertical, size: 3 | é…ç½®æˆåŠŸ |
| ç¯„å›²å¤–é…ç½®ï¼ˆæ¨ªï¼‰ | position: (9,0), direction: horizontal, size: 3 | é…ç½®å¤±æ•— |
| ç¯„å›²å¤–é…ç½®ï¼ˆç¸¦ï¼‰ | position: (0,9), direction: vertical, size: 3 | é…ç½®å¤±æ•— |
| é‡è¤‡é…ç½® | æ—¢ã«é…ç½®æ¸ˆã¿ã®ä½ç½® | é…ç½®å¤±æ•— |
| éš£æ¥é…ç½® | æ—¢å­˜ã®ä¹—ã‚Šç‰©ã®éš£ | é…ç½®æˆåŠŸ |

---

### æ”»æ’ƒãƒ•ã‚§ãƒ¼ã‚º

| ãƒ†ã‚¹ãƒˆé …ç›® | å…¥åŠ› | æœŸå¾…çµæœ |
|-----------|------|---------|
| ãƒŸã‚¹ | ä¹—ã‚Šç‰©ãŒãªã„ãƒã‚¹ | result: 'miss', canContinue: false |
| ãƒ’ãƒƒãƒˆ | ä¹—ã‚Šç‰©ãŒã‚ã‚‹ãƒã‚¹ | result: 'hit', canContinue: true |
| æ’ƒæ²ˆ | æœ€å¾Œã®æ®‹ã‚Šãƒã‚¹ | result: 'sunk', canContinue: true |
| ã‚·ãƒ¼ãƒ«ãƒ‰ã§é˜²å¾¡ | shieldActive: true | result: 'blocked', canContinue: false |
| æ”»æ’ƒæ¸ˆã¿ãƒã‚¹ã¸ã®æ”»æ’ƒ | æ”»æ’ƒæ¸ˆã¿ | ã‚¨ãƒ©ãƒ¼ï¼ˆæ”»æ’ƒä¸å¯ï¼‰ |

---

### ã‚¹ã‚­ãƒ«

| ãƒ†ã‚¹ãƒˆé …ç›® | å…¥åŠ› | æœŸå¾…çµæœ |
|-----------|------|---------|
| ã‚·ãƒ¼ãƒ«ãƒ‰ä½¿ç”¨ | - | shieldActive: true |
| ã‚·ãƒ¼ãƒ«ãƒ‰ã§é˜²å¾¡ | æ”»æ’ƒã‚’å—ã‘ã‚‹ | æ”»æ’ƒç„¡åŠ¹åŒ–ã€shieldActive: false |
| ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆãƒœãƒ  | center: (5,5) | 9ãƒã‚¹æ”»æ’ƒ |
| ã‚¹ã‚¤ãƒ¼ãƒˆã‚¨ã‚¹ã‚±ãƒ¼ãƒ— | ç§»å‹•å¯èƒ½ãªä½ç½® | ç§»å‹•æˆåŠŸ |
| ã‚¹ã‚¤ãƒ¼ãƒˆã‚¨ã‚¹ã‚±ãƒ¼ãƒ— | ç§»å‹•ä¸å¯èƒ½ãªä½ç½® | ç§»å‹•å¤±æ•— |
| æ ¼å­ã‚¹ã‚­ãƒ£ãƒ³ï¼ˆæ¨ªï¼‰ | row: 5 | 5è¡Œç›®ã®ãƒ’ãƒƒãƒˆæƒ…å ±å–å¾— |
| æ ¼å­ã‚¹ã‚­ãƒ£ãƒ³ï¼ˆç¸¦ï¼‰ | col: 3 | 3åˆ—ç›®ã®ãƒ’ãƒƒãƒˆæƒ…å ±å–å¾— |
| æ’ƒæ²ˆå¾Œã®ã‚¹ã‚­ãƒ«ä½¿ç”¨ | sunk: true | ã‚¨ãƒ©ãƒ¼ï¼ˆä½¿ç”¨ä¸å¯ï¼‰ |
| ä½¿ç”¨æ¸ˆã¿ã‚¹ã‚­ãƒ«å†ä½¿ç”¨ | skillUsed: true | ã‚¨ãƒ©ãƒ¼ï¼ˆä½¿ç”¨ä¸å¯ï¼‰ |

---

## ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è€ƒæ…®

### æœ€é©åŒ–ãƒã‚¤ãƒ³ãƒˆ
- æ”»æ’ƒæ¸ˆã¿ãƒã‚¹ã®æ¤œç´¢: `Set` ã‚’ä½¿ç”¨ï¼ˆO(1)ï¼‰
- ãƒœãƒ¼ãƒ‰çŠ¶æ…‹ã®æ›´æ–°: å¿…è¦ãªéƒ¨åˆ†ã®ã¿æ›´æ–°
- P2Pé€šä¿¡: æœ€å°é™ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿é€ä¿¡

### é¿ã‘ã‚‹ã¹ããƒ‘ã‚¿ãƒ¼ãƒ³
- æ¯ãƒ•ãƒ¬ãƒ¼ãƒ ã®ãƒœãƒ¼ãƒ‰å…¨ä½“å†æç”»
- ä¸è¦ãªãƒ‡ã‚£ãƒ¼ãƒ—ã‚³ãƒ”ãƒ¼
- å·¨å¤§ãªã‚²ãƒ¼ãƒ çŠ¶æ…‹ã®é€ä¿¡

---

## ğŸ’° å ±é…¬ã‚·ã‚¹ãƒ†ãƒ ï¼ˆMVPæ‹¡å¼µç‰ˆï¼‰

### æ¦‚è¦
ã‚²ãƒ¼ãƒ å‹åˆ©æ™‚ã«ã‚¹ã‚¤ãƒ¼ãƒ„ã‚³ã‚¤ãƒ³ã‚’ç²å¾—ã—ã€ç§°å·ã‚’è§£æ”¾ã€ã‚·ãƒ§ãƒƒãƒ—ã§ã‚¹ã‚­ãƒ³ã‚’è³¼å…¥ã§ãã‚‹ã‚·ã‚¹ãƒ†ãƒ ã€‚

**MVPç‰ˆã®ç¯„å›²:**
- ç§°å·: 1ã¤ï¼ˆã€Œåˆå‹åˆ©ã€ã®ã¿ï¼‰
- ã‚·ãƒ§ãƒƒãƒ—ã‚¢ã‚¤ãƒ†ãƒ : 1ã¤ï¼ˆã‚·ãƒ§ãƒ¼ãƒˆã‚±ãƒ¼ã‚­ã¡ã‚ƒã‚“ã®ã‚¹ã‚­ãƒ³1ç¨®ï¼‰
- æ‹¡å¼µå¯èƒ½ãªè¨­è¨ˆ

---

### ã‚³ã‚¤ãƒ³ç²å¾—ã‚·ã‚¹ãƒ†ãƒ 

#### ã‚³ã‚¤ãƒ³è¨ˆç®—å¼

```typescript
/**
 * å‹åˆ©æ™‚ã®ã‚³ã‚¤ãƒ³å ±é…¬ã‚’è¨ˆç®—
 * @param result ã‚²ãƒ¼ãƒ çµæœ
 * @returns ã‚³ã‚¤ãƒ³å ±é…¬ã®è©³ç´°
 */
function calculateCoinReward(result: GameResult): CoinReward {
  const bonuses: { type: string; amount: number; description: string }[] = [];
  
  // åŸºæœ¬å ±é…¬
  let baseReward = 100;
  
  // ãƒœãƒ¼ãƒŠã‚¹å ±é…¬
  if (result.mode === 'online') {
    bonuses.push({
      type: 'online',
      amount: 50,
      description: 'ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¯¾æˆ¦ãƒœãƒ¼ãƒŠã‚¹',
    });
  }
  
  if (result.fastWin) {
    bonuses.push({
      type: 'fast_win',
      amount: 50,
      description: 'é€Ÿæ”»ãƒœãƒ¼ãƒŠã‚¹ï¼ˆ10ã‚¿ãƒ¼ãƒ³ä»¥å†…ï¼‰',
    });
  }
  
  if (result.perfectWin) {
    bonuses.push({
      type: 'perfect_win',
      amount: 100,
      description: 'å®Œå…¨å‹åˆ©ãƒœãƒ¼ãƒŠã‚¹ï¼ˆè¢«å¼¾0ï¼‰',
    });
  }
  
  if (result.comebackWin) {
    bonuses.push({
      type: 'comeback_win',
      amount: 80,
      description: 'é€†è»¢å‹åˆ©ãƒœãƒ¼ãƒŠã‚¹',
    });
  }
  
  if (result.usedAllSkills) {
    bonuses.push({
      type: 'all_skills',
      amount: 30,
      description: 'å…¨ã‚¹ã‚­ãƒ«ä½¿ç”¨ãƒœãƒ¼ãƒŠã‚¹',
    });
  }
  
  const total = baseReward + bonuses.reduce((sum, b) => sum + b.amount, 0);
  
  return {
    baseReward,
    bonuses,
    total,
  };
}
```

#### ã‚³ã‚¤ãƒ³ä»˜ä¸å‡¦ç†

```typescript
/**
 * ã‚³ã‚¤ãƒ³ã‚’ä»˜ä¸
 * @param amount ä»˜ä¸ã™ã‚‹ã‚³ã‚¤ãƒ³æ•°
 */
function addCoins(amount: number): void {
  const stats = loadPlayerStats();
  stats.currentCoins += amount;
  stats.totalCoinsEarned += amount;
  savePlayerStats(stats);
}

/**
 * ã‚³ã‚¤ãƒ³ã‚’æ¶ˆè²»
 * @param amount æ¶ˆè²»ã™ã‚‹ã‚³ã‚¤ãƒ³æ•°
 * @returns æˆåŠŸ/å¤±æ•—
 */
function spendCoins(amount: number): boolean {
  const stats = loadPlayerStats();
  
  if (stats.currentCoins < amount) {
    return false; // ã‚³ã‚¤ãƒ³ä¸è¶³
  }
  
  stats.currentCoins -= amount;
  stats.totalCoinsSpent += amount;
  savePlayerStats(stats);
  return true;
}
```

---

### ç§°å·ã‚·ã‚¹ãƒ†ãƒ 

#### MVPç‰ˆã®ç§°å·å®šç¾©

```typescript
/**
 * MVPç‰ˆ: ç§°å·ã¯1ã¤ã®ã¿
 */
const MVP_TITLES: Title[] = [
  {
    id: 'first_win',
    name: 'åˆå‹åˆ©',
    description: 'æœ€åˆã®å‹åˆ©ã‚’é£¾ã£ãŸè¨¼',
    condition: '1å›å‹åˆ©ã™ã‚‹',
    icon: '/assets/images/titles/first_win.png',
    rarity: 'common',
    isUnlocked: false,
  },
];
```

#### ç§°å·è§£æ”¾å‡¦ç†

```typescript
/**
 * ç§°å·ã‚’è§£æ”¾
 * @param titleId ç§°å·ID
 */
function unlockTitle(titleId: string): void {
  const stats = loadPlayerStats();
  
  if (!stats.unlockedTitles.includes(titleId)) {
    stats.unlockedTitles.push(titleId);
    
    // æœ€åˆã®ç§°å·ãªã‚‰è‡ªå‹•è£…å‚™
    if (stats.selectedTitle === null) {
      stats.selectedTitle = titleId;
    }
    
    savePlayerStats(stats);
  }
}

/**
 * ç§°å·ã‚’è£…å‚™
 * @param titleId ç§°å·IDï¼ˆnullã§è§£é™¤ï¼‰
 */
function equipTitle(titleId: string | null): void {
  const stats = loadPlayerStats();
  
  if (titleId === null) {
    stats.selectedTitle = null;
  } else if (stats.unlockedTitles.includes(titleId)) {
    stats.selectedTitle = titleId;
  } else {
    throw new Error('Title not unlocked');
  }
  
  savePlayerStats(stats);
}

/**
 * ç§°å·è§£æ”¾ãƒã‚§ãƒƒã‚¯
 * @param result ã‚²ãƒ¼ãƒ çµæœ
 * @returns æ–°è¦è§£æ”¾ã•ã‚ŒãŸç§°å·IDé…åˆ—
 */
function checkTitleUnlocks(result: GameResult): string[] {
  const stats = loadPlayerStats();
  const newTitles: string[] = [];
  
  // MVPç‰ˆ: åˆå‹åˆ©ã®ç§°å·ã®ã¿ãƒã‚§ãƒƒã‚¯
  if (result.winner === 'player1' && stats.totalWins === 1) {
    if (!stats.unlockedTitles.includes('first_win')) {
      unlockTitle('first_win');
      newTitles.push('first_win');
    }
  }
  
  return newTitles;
}
```

---

### ã‚·ãƒ§ãƒƒãƒ—ã‚·ã‚¹ãƒ†ãƒ 

#### MVPç‰ˆã®ã‚¹ã‚­ãƒ³å®šç¾©

```typescript
/**
 * MVPç‰ˆ: ã‚¹ã‚­ãƒ³1ã¤ã®ã¿
 */
const MVP_SKINS: CharacterSkin[] = [
  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¹ã‚­ãƒ³ï¼ˆç„¡æ–™ã€æœ€åˆã‹ã‚‰æ‰€æŒï¼‰
  {
    id: 'strawberry_default',
    characterType: 'strawberry',
    name: 'ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ',
    description: 'åŸºæœ¬ã®è¡£è£…',
    price: 0,
    rarity: 'common',
    imageFullBody: '/assets/images/characters/strawberry_fullbody.png',
    imageTopView: '/assets/images/characters_topview/strawberry_topview.png',
    isOwned: true,
  },
  // è³¼å…¥å¯èƒ½ã‚¹ã‚­ãƒ³
  {
    id: 'strawberry_summer',
    characterType: 'strawberry',
    name: 'ã‚µãƒãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³',
    description: 'å¤ã®æµ·ãŒä¼¼åˆã†çˆ½ã‚„ã‹ãªè¡£è£…',
    price: 300,
    rarity: 'rare',
    imageFullBody: '/assets/images/characters/strawberry_summer_fullbody.png',
    imageTopView: '/assets/images/characters_topview/strawberry_summer_topview.png',
    isOwned: false,
  },
];
```

#### ã‚¹ã‚­ãƒ³è³¼å…¥å‡¦ç†

```typescript
/**
 * ã‚¹ã‚­ãƒ³ã‚’è³¼å…¥
 * @param skinId ã‚¹ã‚­ãƒ³ID
 * @returns æˆåŠŸ/å¤±æ•—
 */
function purchaseSkin(skinId: string): boolean {
  const stats = loadPlayerStats();
  
  // ã‚¹ã‚­ãƒ³æƒ…å ±ã‚’å–å¾—
  const skin = MVP_SKINS.find(s => s.id === skinId);
  if (!skin) {
    throw new Error('Skin not found');
  }
  
  // æ—¢ã«æ‰€æŒã—ã¦ã„ã‚‹
  if (stats.ownedSkins.includes(skinId)) {
    return false;
  }
  
  // ã‚³ã‚¤ãƒ³æ¶ˆè²»
  if (!spendCoins(skin.price)) {
    return false; // ã‚³ã‚¤ãƒ³ä¸è¶³
  }
  
  // ã‚¹ã‚­ãƒ³è¿½åŠ 
  stats.ownedSkins.push(skinId);
  
  // è‡ªå‹•è£…å‚™
  stats.selectedSkin[skin.characterType] = skinId;
  
  savePlayerStats(stats);
  return true;
}

/**
 * ã‚¹ã‚­ãƒ³ã‚’è£…å‚™
 * @param characterType ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚¿ã‚¤ãƒ—
 * @param skinId ã‚¹ã‚­ãƒ³ID
 */
function equipSkin(characterType: CharacterType, skinId: string): void {
  const stats = loadPlayerStats();
  
  // æ‰€æŒãƒã‚§ãƒƒã‚¯
  if (!stats.ownedSkins.includes(skinId)) {
    throw new Error('Skin not owned');
  }
  
  // è£…å‚™
  stats.selectedSkin[characterType] = skinId;
  savePlayerStats(stats);
}

/**
 * ã‚·ãƒ§ãƒƒãƒ—ã‚¢ã‚¤ãƒ†ãƒ ä¸€è¦§ã‚’å–å¾—
 * @returns ã‚¹ã‚­ãƒ³ä¸€è¦§ï¼ˆæ‰€æŒçŠ¶æ³ã‚’åæ˜ ï¼‰
 */
function getShopItems(): CharacterSkin[] {
  const stats = loadPlayerStats();
  
  return MVP_SKINS.map(skin => ({
    ...skin,
    isOwned: stats.ownedSkins.includes(skin.id),
  }));
}
```

---

### çµ±è¨ˆè¨˜éŒ²ã‚·ã‚¹ãƒ†ãƒ 

#### ã‚²ãƒ¼ãƒ çµ‚äº†æ™‚ã®çµ±è¨ˆæ›´æ–°

```typescript
/**
 * ã‚²ãƒ¼ãƒ çµ‚äº†æ™‚ã®çµ±è¨ˆæ›´æ–°
 * @param result ã‚²ãƒ¼ãƒ çµæœ
 */
function updateGameStats(result: GameResult): void {
  const stats = loadPlayerStats();
  
  // åŸºæœ¬çµ±è¨ˆ
  stats.totalGames++;
  
  if (result.winner === 'player1') {
    // å‹åˆ©
    stats.totalWins++;
    stats.currentWinStreak++;
    stats.maxWinStreak = Math.max(stats.maxWinStreak, stats.currentWinStreak);
    
    // ãƒ¢ãƒ¼ãƒ‰åˆ¥
    if (result.mode === 'online') {
      stats.onlineWins++;
    } else {
      stats.cpuWins++;
    }
    
    // ç‰¹æ®Šè¨˜éŒ²
    if (result.perfectWin) {
      stats.perfectWins++;
    }
    if (result.comebackWin) {
      stats.comebackWins++;
    }
    stats.fastestWin = Math.min(stats.fastestWin, result.turnCount);
    
  } else {
    // æ•—åŒ—
    stats.totalLosses++;
    stats.currentWinStreak = 0;
    
    if (result.mode === 'online') {
      stats.onlineLosses++;
    } else {
      stats.cpuLosses++;
    }
  }
  
  // å‹ç‡è¨ˆç®—
  stats.winRate = Math.round((stats.totalWins / stats.totalGames) * 100 * 10) / 10;
  
  // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åˆ¥çµ±è¨ˆï¼ˆå°†æ¥å®Ÿè£…ç”¨ï¼‰
  stats.characterStats[result.character].gamesPlayed++;
  if (result.winner === 'player1') {
    stats.characterStats[result.character].wins++;
  } else {
    stats.characterStats[result.character].losses++;
  }
  
  savePlayerStats(stats);
}
```

---

### ã‚²ãƒ¼ãƒ çµæœã®åˆ¤å®š

```typescript
/**
 * å®Œå…¨å‹åˆ©åˆ¤å®šï¼ˆè¢«å¼¾0ï¼‰
 */
function checkPerfectWin(gameState: GameState, winner: PlayerId): boolean {
  const winnerState = gameState.players[winner];
  return winnerState.remainingMasses === winnerState.totalMasses;
}

/**
 * å…¨ã‚¹ã‚­ãƒ«ä½¿ç”¨åˆ¤å®š
 */
function checkAllSkillsUsed(gameState: GameState, winner: PlayerId): boolean {
  const winnerState = gameState.players[winner];
  return winnerState.activeSkills.length === 4;
}

/**
 * é€†è»¢å‹åˆ©åˆ¤å®šï¼ˆHP30%ä»¥ä¸‹ã‹ã‚‰ï¼‰
 * â€»ã“ã‚Œã‚’æ­£ç¢ºã«åˆ¤å®šã™ã‚‹ã«ã¯ã‚²ãƒ¼ãƒ ä¸­ã®æœ€å°HPè¨˜éŒ²ãŒå¿…è¦
 */
function checkComebackWin(gameState: GameState, winner: PlayerId): boolean {
  // MVPç‰ˆã§ã¯ç°¡æ˜“å®Ÿè£…
  // æœ¬æ¥ã¯ã‚²ãƒ¼ãƒ ä¸­ã®æœ€å°HPã‚’è¨˜éŒ²ã—ã¦åˆ¤å®š
  // ä»Šå›ã¯çµ‚äº†æ™‚ã®HPå·®ã§ä»£ç”¨
  const winnerState = gameState.players[winner];
  const loserState = gameState.players[winner === 'player1' ? 'player2' : 'player1'];
  
  // å‹è€…ã®HPãŒ50%ä»¥ä¸‹ã§ã€æ•—è€…ã‚’å…¨æ»…ã•ã›ãŸå ´åˆã‚’é€†è»¢å‹åˆ©ã¨ã¿ãªã™
  return winnerState.hp <= 50;
}
```

---

### ã‚²ãƒ¼ãƒ çµ‚äº†å‡¦ç†ã®çµ±åˆ

```typescript
/**
 * ã‚²ãƒ¼ãƒ çµ‚äº†æ™‚ã®å…¨å‡¦ç†
 * @param gameState ã‚²ãƒ¼ãƒ çŠ¶æ…‹
 */
function onGameFinished(gameState: GameState): void {
  const winner = gameState.winner;
  if (!winner) return;
  
  // Player1ãŒå‹ã£ãŸå ´åˆã®ã¿å ±é…¬å‡¦ç†
  if (winner !== 'player1') return;
  
  // ã‚²ãƒ¼ãƒ çµæœã‚’ä½œæˆ
  const result: GameResult = {
    winner,
    mode: gameState.mode,
    turnCount: gameState.turnCount,
    perfectWin: checkPerfectWin(gameState, winner),
    usedAllSkills: checkAllSkillsUsed(gameState, winner),
    comebackWin: checkComebackWin(gameState, winner),
    fastWin: gameState.turnCount <= 10,
    character: gameState.players.player1.character,
  };
  
  // çµ±è¨ˆæ›´æ–°
  updateGameStats(result);
  
  // ã‚³ã‚¤ãƒ³ç²å¾—
  const coinReward = calculateCoinReward(result);
  addCoins(coinReward.total);
  
  // ç§°å·ãƒã‚§ãƒƒã‚¯
  const newTitles = checkTitleUnlocks(result);
  
  // çµæœç”»é¢ã¸é·ç§»ï¼ˆå ±é…¬æƒ…å ±ã‚’æ¸¡ã™ï¼‰
  navigateToResultScreen({
    result,
    coinReward,
    newTitles,
  });
}
```

---

### LocalStorageç®¡ç†

#### ãƒ‡ãƒ¼ã‚¿ä¿å­˜ãƒ»èª­ã¿è¾¼ã¿

```typescript
const STORAGE_KEY = 'sweets_ship_strike_player_stats';

/**
 * ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼çµ±è¨ˆã‚’ä¿å­˜
 */
function savePlayerStats(stats: PlayerStats): void {
  try {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(stats));
  } catch (e) {
    console.error('Failed to save player stats:', e);
  }
}

/**
 * ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼çµ±è¨ˆã‚’èª­ã¿è¾¼ã¿
 */
function loadPlayerStats(): PlayerStats {
  try {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (saved) {
      return JSON.parse(saved);
    }
  } catch (e) {
    console.error('Failed to load player stats:', e);
  }
  return createDefaultPlayerStats();
}

/**
 * ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼çµ±è¨ˆã‚’ä½œæˆ
 */
function createDefaultPlayerStats(): PlayerStats {
  return {
    totalGames: 0,
    totalWins: 0,
    totalLosses: 0,
    winRate: 0,
    currentWinStreak: 0,
    maxWinStreak: 0,
    onlineWins: 0,
    onlineLosses: 0,
    cpuWins: 0,
    cpuLosses: 0,
    totalAttacks: 0,
    totalHits: 0,
    hitRate: 0,
    totalShipsSunk: 0,
    totalSkillsUsed: 0,
    fastestWin: Infinity,
    perfectWins: 0,
    comebackWins: 0,
    characterStats: {
      strawberry: { gamesPlayed: 0, wins: 0, losses: 0 },
      chocolate: { gamesPlayed: 0, wins: 0, losses: 0 },
      macaron: { gamesPlayed: 0, wins: 0, losses: 0 },
      pudding: { gamesPlayed: 0, wins: 0, losses: 0 },
    },
    totalCoinsEarned: 0,
    totalCoinsSpent: 0,
    currentCoins: 0, // åˆæœŸã‚³ã‚¤ãƒ³0
    ownedSkins: [
      'strawberry_default',
      'chocolate_default',
      'macaron_default',
      'pudding_default',
    ],
    ownedThemes: ['cream_sea'], // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ†ãƒ¼ãƒï¼ˆå°†æ¥å®Ÿè£…ç”¨ï¼‰
    ownedEffects: ['default_explosion'], // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼ˆå°†æ¥å®Ÿè£…ç”¨ï¼‰
    unlockedTitles: [],
    selectedTitle: null,
    selectedSkin: {
      strawberry: 'strawberry_default',
      chocolate: 'chocolate_default',
      macaron: 'macaron_default',
      pudding: 'pudding_default',
    },
    selectedTheme: 'cream_sea',
    selectedEffect: 'default_explosion',
  };
}

/**
 * ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
 */
function resetPlayerStats(): void {
  localStorage.removeItem(STORAGE_KEY);
}
```

---

### æ‹¡å¼µæ€§ã®ç¢ºä¿

#### å°†æ¥ã®æ‹¡å¼µãƒã‚¤ãƒ³ãƒˆ

```typescript
/**
 * ç§°å·å®šç¾©ã‚’æ‹¡å¼µã™ã‚‹å ´åˆ
 */
const ALL_TITLES: Title[] = [
  ...MVP_TITLES,
  // æ–°ã—ã„ç§°å·ã‚’è¿½åŠ 
  {
    id: 'win_streak_3',
    name: 'ä¸‰é€£å‹',
    description: '3é€£å‹ã‚’é”æˆã—ãŸå¼·è€…',
    condition: '3é€£å‹ã™ã‚‹',
    icon: '/assets/images/titles/win_streak_3.png',
    rarity: 'rare',
    isUnlocked: false,
  },
  // ...
];

/**
 * ã‚¹ã‚­ãƒ³å®šç¾©ã‚’æ‹¡å¼µã™ã‚‹å ´åˆ
 */
const ALL_SKINS: CharacterSkin[] = [
  ...MVP_SKINS,
  // æ–°ã—ã„ã‚¹ã‚­ãƒ³ã‚’è¿½åŠ 
  {
    id: 'chocolate_halloween',
    characterType: 'chocolate',
    name: 'ãƒãƒ­ã‚¦ã‚£ãƒ³è¡£è£…',
    description: 'ãƒˆãƒªãƒƒã‚¯ãƒ»ã‚ªã‚¢ãƒ»ãƒˆãƒªãƒ¼ãƒˆï¼',
    price: 500,
    rarity: 'rare',
    imageFullBody: '/assets/images/characters/chocolate_halloween_fullbody.png',
    imageTopView: '/assets/images/characters_topview/chocolate_halloween_topview.png',
    isOwned: false,
  },
  // ...
];

/**
 * ç§°å·è§£æ”¾ãƒã‚§ãƒƒã‚¯ã‚’æ‹¡å¼µã™ã‚‹å ´åˆ
 */
function checkAllTitleUnlocks(result: GameResult): string[] {
  const stats = loadPlayerStats();
  const newTitles: string[] = [];
  
  // åˆå‹åˆ©
  if (result.winner === 'player1' && stats.totalWins === 1) {
    if (!stats.unlockedTitles.includes('first_win')) {
      unlockTitle('first_win');
      newTitles.push('first_win');
    }
  }
  
  // ä¸‰é€£å‹ï¼ˆå°†æ¥å®Ÿè£…ï¼‰
  if (stats.currentWinStreak === 3) {
    if (!stats.unlockedTitles.includes('win_streak_3')) {
      unlockTitle('win_streak_3');
      newTitles.push('win_streak_3');
    }
  }
  
  // ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆå‹åˆ©ï¼ˆå°†æ¥å®Ÿè£…ï¼‰
  if (result.perfectWin) {
    if (!stats.unlockedTitles.includes('perfect_win')) {
      unlockTitle('perfect_win');
      newTitles.push('perfect_win');
    }
  }
  
  // ... ä»–ã®ç§°å·ã‚‚åŒæ§˜ã«è¿½åŠ 
  
  return newTitles;
}
```

---

## ğŸ“Š MVPæ‹¡å¼µç‰ˆã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

### ã‚³ã‚¤ãƒ³ç²å¾—

| ãƒ†ã‚¹ãƒˆé …ç›® | å…¥åŠ› | æœŸå¾…çµæœ |
|-----------|------|---------|
| åŸºæœ¬å ±é…¬ | CPUå‹åˆ©ã€é€šå¸¸ | 100ã‚³ã‚¤ãƒ³ |
| ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒœãƒ¼ãƒŠã‚¹ | ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å‹åˆ© | 150ã‚³ã‚¤ãƒ³ |
| é€Ÿæ”»ãƒœãƒ¼ãƒŠã‚¹ | 10ã‚¿ãƒ¼ãƒ³ä»¥å†…å‹åˆ© | 150ã‚³ã‚¤ãƒ³ |
| å®Œå…¨å‹åˆ© | è¢«å¼¾0ã§å‹åˆ© | 200ã‚³ã‚¤ãƒ³ |
| è¤‡åˆãƒœãƒ¼ãƒŠã‚¹ | ã‚ªãƒ³ãƒ©ã‚¤ãƒ³+é€Ÿæ”»+å®Œå…¨å‹åˆ© | 300ã‚³ã‚¤ãƒ³ |

### ç§°å·è§£æ”¾

| ãƒ†ã‚¹ãƒˆé …ç›® | æ¡ä»¶ | æœŸå¾…çµæœ |
|-----------|------|---------|
| åˆå‹åˆ©ç§°å· | åˆã‚ã¦å‹åˆ© | ã€Œåˆå‹åˆ©ã€è§£æ”¾ |
| 2å›ç›®ã®å‹åˆ© | 2å›ç›®ã®å‹åˆ© | ç§°å·è§£æ”¾ãªã— |
| æ•—åŒ—æ™‚ | æ•—åŒ— | ç§°å·è§£æ”¾ãªã— |

### ã‚·ãƒ§ãƒƒãƒ—

| ãƒ†ã‚¹ãƒˆé …ç›® | æ¡ä»¶ | æœŸå¾…çµæœ |
|-----------|------|---------|
| è³¼å…¥æˆåŠŸ | 300ã‚³ã‚¤ãƒ³æ‰€æŒã€è³¼å…¥ | ã‚³ã‚¤ãƒ³æ¸›ç®—ã€ã‚¹ã‚­ãƒ³è§£æ”¾ |
| ã‚³ã‚¤ãƒ³ä¸è¶³ | 100ã‚³ã‚¤ãƒ³æ‰€æŒã€è³¼å…¥è©¦è¡Œ | è³¼å…¥å¤±æ•— |
| é‡è¤‡è³¼å…¥ | æ—¢ã«æ‰€æŒã€è³¼å…¥è©¦è¡Œ | è³¼å…¥ä¸å¯ |
| è³¼å…¥å¾Œè£…å‚™ | ã‚¹ã‚­ãƒ³è³¼å…¥ | è‡ªå‹•çš„ã«è£…å‚™ã•ã‚Œã‚‹ |

---

## ğŸ¨ å¿…è¦ãªè¿½åŠ ç´ æï¼ˆMVPæ‹¡å¼µç‰ˆï¼‰

### ç”»åƒç´ æ
- **ç§°å·ã‚¢ã‚¤ã‚³ãƒ³**: 1æšï¼ˆåˆå‹åˆ©ç”¨ï¼‰
- **ã‚­ãƒ£ãƒ©ã‚¹ã‚­ãƒ³**: 2æš
  - ã‚·ãƒ§ãƒ¼ãƒˆã‚±ãƒ¼ã‚­ã¡ã‚ƒã‚“ ã‚µãƒãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆå…¨èº«ï¼‰
  - ã‚·ãƒ§ãƒ¼ãƒˆã‚±ãƒ¼ã‚­ã¡ã‚ƒã‚“ ã‚µãƒãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆçœŸä¸Šï¼‰
- **UIã‚¢ã‚¤ã‚³ãƒ³**: 1æš
  - ã‚³ã‚¤ãƒ³ã‚¢ã‚¤ã‚³ãƒ³ ğŸª™

**åˆè¨ˆ: 4æš**

### ã‚µã‚¦ãƒ³ãƒ‰ç´ æï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
- ã‚³ã‚¤ãƒ³ç²å¾—SEï¼ˆãƒãƒ£ãƒªãƒ¼ãƒ³ï¼‰
- ç§°å·ç²å¾—SEï¼ˆãƒ•ã‚¡ãƒ³ãƒ•ã‚¡ãƒ¼ãƒ¬ï¼‰
- ã‚·ãƒ§ãƒƒãƒ—è³¼å…¥SEï¼ˆãƒ¬ã‚¸éŸ³ï¼‰

---

## ğŸ“„ å¤‰æ›´å±¥æ­´

| æ—¥ä»˜ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | å¤‰æ›´å†…å®¹ |
|------|-----------|----------|
| 2025-10-31 | 1.0 | åˆç‰ˆä½œæˆ |
| 2025-10-31 | 1.1 | å ±é…¬ã‚·ã‚¹ãƒ†ãƒ ï¼ˆMVPæ‹¡å¼µç‰ˆï¼‰è¿½åŠ  |

---

**ä»¥ä¸Šã€ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯è¨­è¨ˆæ›¸ã§ã—ãŸã€‚**